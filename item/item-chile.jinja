{# ============================ 
  PRINT FORMAT: Ficha Técnica de Producto (Chile)
============================ #}

{# Try to access default company in multiple ways using frappe.db.get_value with filters #}
{% set company_name = doc.default_company %}
{% if not company_name %}
    {% set company_name = frappe.db.get_value("Global Defaults", None, "default_company") %}
{% endif %}
{% if not company_name %}
    {% set company_name = frappe.db.get_value("Company", {"is_default": 1}, "name") %}
{% endif %}
{% if not company_name %}
    {% set company_name = frappe.db.get_value("Company", {}, "name") %}
{% endif %}

{# Fetch full Company doc #}
{% set company_doc = frappe.get_doc("Company", company_name) if company_name else None %}

<div class="pf">

    {# --- HEADER --- #}
    <div class="header">
        <div class="h-left">
            <div class="doc-type">Ficha Técnica</div>
            <div class="title">{{ doc.item_name }}</div>
            <div class="subtitle">{{ doc.item_code }}</div>
        </div>
        <div class="h-right">
          <img src="{{ frappe.utils.get_url(company_doc.company_logo) }}" />
        </div>
    </div>

    {# --- HERO SECTION: IMAGE & DESCRIPTION --- #}
    <div class="hero">
        <div class="hero-img-col">
            {% if doc.image %}
            <img src="{{ doc.image }}" class="main-product-image" />
            {% else %}
            <div class="main-product-image" style="height: 200px; display: flex; align-items: center; justify-content: center; background: #f0f0f0; color: #ccc;">
                Sin Imagen
            </div>
            {% endif %}
        </div>
        <div class="hero-desc-col">
            <div class="card description-box">
                <div class="section-title">Descripción</div>
                <div style="line-height: 1.6;">
                   {{ doc.description or doc.item_name }}
                </div>
            </div>
        </div>
    </div>

    {# --- SPECS SECTION --- #}
    <div class="specs-container">
        
        <div class="specs-grid">
            {# -- COL 1: DIMENSIONS -- #}
            <div class="spec-col">
                <div class="card">
                    <div class="section-title">Dimensiones</div>
                    <table class="spec-table">
                        <tbody>
                            {% if doc.custom_diameter %}
                            <tr>
                                <td class="spec-label">Diámetro</td>
                                <td class="spec-value">{{ doc.custom_diameter }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_height %}
                            <tr>
                                <td class="spec-label">Altura</td>
                                <td class="spec-value">{{ doc.custom_height }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_area %}
                            <tr>
                                <td class="spec-label">Área</td>
                                <td class="spec-value">{{ doc.custom_area }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_perimeter %}
                            <tr>
                                <td class="spec-label">Perímetro</td>
                                <td class="spec-value">{{ doc.custom_perimeter }}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            {# -- COL 2: RESISTANCE & INSTALLATION -- #}
            <div class="spec-col">
                <div class="card">
                    <div class="section-title">Resistencia e Instalación</div>
                    <table class="spec-table">
                        <tbody>
                            {% if doc.custom_wind_resistance %}
                            <tr>
                                <td class="spec-label">Resistencia Viento</td>
                                <td class="spec-value">{{ doc.custom_wind_resistance }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_snow_resistance %}
                            <tr>
                                <td class="spec-label">Resistencia Nieve</td>
                                <td class="spec-value">{{ doc.custom_snow_resistance }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_impermeability %}
                            <tr>
                                <td class="spec-label">Impermeabilidad</td>
                                <td class="spec-value">{{ doc.custom_impermeability }}</td>
                            </tr>
                            {% endif %}
                            {% if doc.custom_installation_days %}
                            <tr>
                                <td class="spec-label">Tiempo Instalación</td>
                                <td class="spec-value">{{ doc.custom_installation_days }}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        {# -- STRUCTURE -- #}
        <div class="card">
            <div class="section-title">Estructura</div>
            <table class="spec-table">
                <tbody>
                    {% if doc.custom_structure_material %}
                    <tr>
                        <td class="spec-label">Material</td>
                        <td class="spec-value">{{ doc.custom_structure_material }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_structure_warranty %}
                    <tr>
                        <td class="spec-label">Garantía</td>
                        <td class="spec-value">{{ doc.custom_structure_warranty }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_structure_life_span %}
                    <tr>
                        <td class="spec-label">Vida Útil</td>
                        <td class="spec-value">{{ doc.custom_structure_life_span }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_structure_min_operation_temp or doc.custom_structure_max_operation_temp %}
                    <tr>
                        <td class="spec-label">Temp. Operación</td>
                        <td class="spec-value">
                            {{ doc.custom_structure_min_operation_temp or "?" }} / {{ doc.custom_structure_max_operation_temp or "?" }}
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        {# -- COVER -- #}
        <div class="card">
            <div class="section-title">Cubierta</div>
            <table class="spec-table">
                <tbody>
                    {% if doc.custom_opaque_cover_material %}
                    <tr>
                        <td class="spec-label">Material Opaco</td>
                        <td class="spec-value">{{ doc.custom_opaque_cover_material }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_transparent_cover_material %}
                    <tr>
                        <td class="spec-label">Material Transparente</td>
                        <td class="spec-value">{{ doc.custom_transparent_cover_material }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_cover_warranty %}
                    <tr>
                        <td class="spec-label">Garantía</td>
                        <td class="spec-value">{{ doc.custom_cover_warranty }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_cover_life_span %}
                    <tr>
                        <td class="spec-label">Vida Útil</td>
                        <td class="spec-value">{{ doc.custom_cover_life_span }}</td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_cover_min_operation_temp or doc.custom_cover_max_operation_temp %}
                    <tr>
                        <td class="spec-label">Temp. Operación</td>
                        <td class="spec-value">
                             {{ doc.custom_cover_min_operation_temp or "?" }} / {{ doc.custom_cover_max_operation_temp or "?" }}
                        </td>
                    </tr>
                    {% endif %}
                    {% if doc.custom_insulation_material %}
                    <tr>
                        <td class="spec-label">Aislación</td>
                        <td class="spec-value">{{ doc.custom_insulation_material }}</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

    </div>

    {# --- FOOTER --- #}
    <div class="footer">
         <div class="company-info">
            {% if company_doc %}
                <div class="company-name">{{ company_doc.name }}</div>
                {% if company_doc.tax_id %}
                <div class="company-detail"><span class="label">RUT:</span> {{ company_doc.tax_id }}</div>
                {% endif %}
                
                {% if company_doc.address %}
                 <div class="company-detail">{{ company_doc.address | replace("\n", ", ") }}</div>
                {% endif %}

                <div class="company-contact">
                    {% if company_doc.phone_no %}<span class="item">Tel: {{ company_doc.phone_no }}</span>{% endif %}
                    {% if company_doc.email %}<span class="item">Email: {{ company_doc.email }}</span>{% endif %}
                    {% if company_doc.website %}<span class="item">{{ company_doc.website }}</span>{% endif %}
                </div>
            {% endif %}
         </div>
    </div>

</div>
